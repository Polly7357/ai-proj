{% extends 'bases/base.html' %}

{% block headmessage %}
    <div style="text-align: left;">
        生活碳足跡計算
    </div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <p> 日期：<input type="text" id="datepicker" class="form-control" value="2023/9/14" style="width: 200px; height: 30px"> </p>


    </div>
    
    </div>
    <!--<div class="col-md-3">
        <button class="btn btn-primary">完成</button>
    </div>-->
</div>

<div>
    <p>生活碳足跡</p>
    <p id="carbonFootprintDate"></p> <!-- 用于显示日期 -->
    <!-- 在这里添加生活碳足迹计算的内容 -->
</div>
<hr>
<div class="row">
    <div class="col-md-6">
        <div>

            <label for="itemSelect">選擇品項:</label>
            <select id="itemSelect" name="itemSelect">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>

            </select>
            <br>
            <label for="unitInput">輸入單位:</label>
            <input type="text" id="unitInput" name="unitInput">
            <br>
            <button id="addItemButton">新增項目</button>
            <button id="resetButton">重設</button>
            <div id="itemList"></div>
        </div>
    </div>

    
    <div class="col-md-6">
        <p>今日碳排放量</p>
        <br>
        <div id="carbonBarChartContainer">
            <canvas id="carbonBarChart3" width="400" height="200"></canvas>
        </div>
    </div>

    <br>
<div>
    <label for="total_cde_beverage">total_cde_beverage:</label>
    <input type="text" id="total_cde_beverage" readonly value="">
</div>
        
<div>
    <label for="total_cde_cde_transport">total_cde_cde_transport:</label>
    <input type="text" id="total_cde_cde_transport" readonly value="">
</div>
        
<div>
    <label for="total_cde_energy">total_cde_energy:</label>
    <input type="text" id="total_cde_energy" readonly value="">
</div>

<div>
    <label for="total_cde_lactose_prods">otal_cde_lactose_prods:</label>
    <input type="text" id="total_cde_lactose_prods" readonly value="">
</div>



{% endblock %}
{% block js_script %}
<script>
    axios.get('http://127.0.0.1:8000/api/cde/')
    .then((res)=>{
        console.log(res.data)
        $(`#total_cde_beverage`).val(res.data.total_cde_beverage);
        $(`#total_cde_cde_transport`).val(res.data.total_cde_cde_transport);
        $(`#total_cde_energy`).val(res.data.total_cde_energy);
        $(`#total_cde_lactose_prods`).val(res.data.total_cde_lactose_prods);        
    })
    .catch((error)=>{

    })
</script>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 创建并渲染长条图表
        const ctx = document.getElementById('carbonBarChart3').getContext('2d');
        const data = {
            labels: ['total_cde_beverage', 'total_cde_cde_transport', 'total_cde_energy','otal_cde_lactose_prods'], // 电器名称将在后续添加
            datasets: [{
                label: '碳排放量',
                data: [], // 实际数据将在后续添加
                backgroundColor: ['#FF5733', '#33FF57', '#5733FF','#5733FF'], // 长条的颜色
            }],
        };

        const carbonBarChart = new Chart(ctx, {
            type: 'bar',
            data: data,
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // 初始化柱状图数据
        carbonBarChart.data.datasets[0].data = [0, 0, 0];
        carbonBarChart.update();

        // 获取数据并更新柱状图和标签
        axios.get('http://127.0.0.1:8000/api/cde/')
            .then((res) => {
                const total_cde_beverage = res.data.total_cde_beverage;
                const total_cde_cde_transport = res.data.total_cde_cde_transport;
                const total_cde_energy = res.data.total_cde_energy/30;
                const total_cde_lactose_prods = res.data.total_cde_lactose_prods

                // 更新柱状图和标签
                carbonBarChart.data.datasets[0].data = [total_cde_beverage, total_cde_cde_transport, total_cde_energy,total_cde_lactose_prods];
                carbonBarChart.update();

                // 更新标签对应的输入框
                //document.getElementById('total_cde_beverage').value = total_cde_beverage;
                //document.getElementById('total_cde_cde_transport').value = total_cde_cde_transport;
                document.getElementById('total_cde_energy').value = total_cde_energy;
                //document.getElementById('total_cde_lactose_prods').value = total_cde_lactose_prods;
            })
            .catch((error) => {
                console.error(error);
            });
    });
</script>

{% endblock %}