{% extends 'bases/base.html' %}

{% block headmessage %}
<div style="text-align: center;">
    <p> </p>
    <p> </p>
    <div style="text-align: left;">生活碳足跡計算</div>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div style="display: flex; align-items: center; margin-top: 20px;">
            <label for="datepicker" style="font-weight: bold; margin-right: 10px;">日期:</label>
            <input type="text" id="datepicker" class="form-control" value="2023/9/14" style="width: 200px; height: 30px;">
        </div>
          


    </div>
    
    </div>
    <!--<div class="col-md-3">
        <button class="btn btn-primary">完成</button>
    </div>-->
</div>

<div>
 
    <p id="carbonFootprintDate"></p> <!-- 用于显示日期 -->
    <!-- 在这里添加生活碳足迹计算的内容 -->
</div>

<hr >

<div style="display: flex; justify-content: space-between;">
    <!-- 左方区域 -->
    <div style="flex: 1; margin-right: 80px;">
        <label for="applianceSelect" style="font-size: 16px;">選擇電器:</label>
        <select id="applianceSelect" name="applianceSelect" style="font-size: 18px; width: 250px;background-color:  #F0FFFF;">
            <option value="1">電冰箱</option>
            <option value="2">電鍋</option>
            <option value="3">開飲機</option>
            <option value="4">微波爐</option>
            <option value="5">抽油煙機</option>
            <option value="6">果汁機</option>
            <option value="7">果榨汁機</option>
            <option value="8">烘碗機</option>
            <option value="9">電磁爐</option>
            <option value="10">多功能火鍋</option>
            <option value="11">烤麵包機</option>
            <option value="12">電咖啡壺</option>
            <option value="13">電烤箱</option>
            <option value="14">洗衣機</option>
            <option value="15">乾衣機</option>
            <option value="16">電熨斗</option>
            <option value="17">冷氣機</option>
            <option value="18">吹風機</option>
            <option value="19">電暖爐</option>
            <option value="20">電扇</option>
            <option value="21">吸塵器</option>
            <option value="22">抽風機</option>
            <option value="23">燈泡(60W)</option>
            <option value="24">日光燈(20W)</option>
            <option value="25">省電燈泡</option>
            <option value="26">神龕燈</option>
            <option value="27">電視機</option>
            <option value="28">機上盒</option>
            <option value="29">音響</option>
            <option value="30">收音機</option>
            <option value="31">電腦:主機+顯示器</option>
            <option value="32">印表機</option>
            <option value="33">手機充電器</option>
            <option value="34">筆記型電腦MacBook Pro</option>
            <option value="35">電熱水器</option>
            <option value="36">電熱水瓶</option>
            <option value="37">變頻冷氣</option>
        </select>
        <br>
        <label for="startTimeInput" style="font-size: 16px;">開始時間:</label>
        <input type="text" id="startTimeInput" name="startTimeInput" style="font-size: 16px; width: 200px;">
        
        <br>
        <label for="endTimeInput" style="font-size: 16px;">結束時間:</label>
        <input type="text" id="endTimeInput" name="endTimeInput" style="font-size: 16px; width: 200px;">
        <br>

        <p> </p>

        <button id="addApplianceButton2" style="background-color: #0071E3; color: #FFF; font-size: 16px; font-weight: bold; font-family: Arial, sans-serif; border: 1px solid #3366cc; border-radius: 5px; box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); cursor: pointer; width: 100px; height: 30px;">新增電器</button>
        <button id="resetButton2" style="background-color: #999; color: #FFF; font-size: 16px; font-weight: bold; font-family: Arial, sans-serif; border: 1px solid #999; border-radius: 5px; box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); cursor: pointer; width: 100px; height: 30px;">重設</button>
        <button id="packageButton2" style="background-color: #BF4800; color: #FFF; font-size: 16px; font-weight: bold; font-family: Arial, sans-serif; border: 1px solid #4CAF50; border-radius: 5px; box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); cursor: pointer; width: 100px; height: 30px;">打包</button>
        
        <div id="itemList2"></div>


        <p style="margin-top: 50px; margin-bottom: 100px;"></p>
        


        <table>
            <tr>
                <td>
                    <label for="DailyElectricity" style="font-weight: bold;">每日用電(kWh):</label>
                </td>
                <td>
                    <input type="text" id="DailyElectricity" readonly value="">
                </td>
            </tr>
            <tr>
                <td>
                    <label for="Reality" style="font-weight: bold;">月排碳量(CO2e):</label>
                </td>
                <td>
                    <input type="text" id="MonthlyCarbonEmission" readonly value="">
                </td>
            </tr>
            <tr>
                <td>
                    <label for="Reality" style="font-weight: bold;">每月用電(kWh):</label>
                </td>
                <td>
                    <input type="text" id="MonthlyElectricity" readonly value="">
                </td>
            </tr>
        </table>
        

    </div>


    <style>
        .custom-button {
            background-color: #434343; /* 绿色 */
            color: #F0FFFF; /* 白色文字 */
            font-size: 14px; /* 较小的字体大小 */
            font-weight: normal; /* 正常字体粗细 */
            font-family: Arial, sans-serif; /* 字体 */
            border: none; /* 去除边框 */
            border-radius: 3px; /* 小圆角边框 */
            padding: 8px 10px; /* 内边距 */
            cursor: pointer; /* 光标形状 */
            margin-right: 10px; /* 右侧间距，可以根据需要调整 */
        }
    </style>
    

    

    <!-- 右方区域 -->
    <div style="flex: 1;">
        <div class="apple-style-title">
            預估費用
        </div>
        
        <style>
        .apple-style-title {
            text-align: left;
            background-color: #f8f8f8;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 0px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            opacity: 0; /* 将初始透明度设置为0，元素开始时不可见 */
            animation: fadeIn 1.8s ease-in-out forwards; /* 应用淡入动画 */
        }
        
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        </style>
        
        
        
        <canvas id="carbonBarChart" width="580" height="250"></canvas>
        <br>

        <style>
            .custom-button {
                margin-right: 65px; /* 这里设置按钮右侧的外边距为 20 像素，根据需要进行调整 */
            }
        </style>
        <button id="showChartButton" class="custom-button">顯示長條圖</button>
        <button id="showChartButton2" class="custom-button">每日費用</button>
        <button id="showChartButton3" class="custom-button">每月費用</button>
        <button id="showChartButton4" class="custom-button">周末費用</button>
        
    </div>
</div>





<hr>



<style>
    .container1 {
        display: flex;
        flex-wrap: wrap;
        margin-top: 30px; /* 添加上外边距来使整体往下移动 */
        margin-bottom: 30px; /* 下邊距 */
    }

    .left-column {
        flex: 0 0 calc(50% - 40px);
        margin-right: 40px; /* 调整左侧列之间的间距 */
    }

    .right-column {
        flex: 0 0 calc(50% - 40px);
    }

    .label {
        font-weight: bold;
        color: #8E8E93;
    }



</style>





<div class="container1">
    <div class="left-column">
       
      

        <span class="label" style="color: #0066cc; opacity: 0;">三段式</span>

<style>
.label {
    font-weight: bold;
}

.label.animation {
    opacity: 1;
    animation: fadeIn 1.8s ease-in-out forwards; /* 将动画持续时间延长为2秒 */
}

@keyframes fadeIn {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}
</style>

<script>
// 使用JavaScript来添加动画类
document.addEventListener("DOMContentLoaded", function() {
    const labelElement = document.querySelector(".label");
    labelElement.classList.add("animation");
});
</script>

        <div>
            <label for="ThreeTier" style="font-weight: bold;">每日費用(元):</label>
            <input type="text" id="ThreeTierDailyCost" readonly value="">
        </div>
        <div>
            <label for="ThreeTier" style="font-weight: bold;">每月費用(元):</label>
            <input type="text" id="ThreeTierMonthlyCost" readonly value="">
        </div>
        <div>
            <label for="ThreeTier" style="font-weight: bold;">周末費用(元):</label>
            <input type="text" id="ThreeTierWeekendCost" readonly value="">
        </div>

        <p> </p>

        
        <span class="label-1" style="color: #0066cc; opacity: 0;">三段式夏季</span>

        <style>
        .label-1 {
            font-weight: bold;
        }
        
        .label-1 {
            opacity: 1;
            animation: fadeInSummer 1.8s ease-in-out forwards;
        }
        
        @keyframes fadeInSummer {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        </style>
        
        <script>
        document.addEventListener("DOMContentLoaded", function() {
            const labelElementSummer = document.querySelector(".label-1");
            labelElementSummer.classList.add("animation");
        });
        </script>









        
        <div>
            <label for="ThreeTierSummer" style="font-weight: bold;">每日費用(元):</label>
            <input type="text" id="ThreeTierSummerDailyCost" readonly value="">
        </div>
        <div>
            <label for="ThreeTierSummer" style="font-weight: bold;">每月費用(元):</label>
            <input type="text" id="ThreeTierSummerMonthlyCost" readonly value="">
        </div>
        <div>
            <label for="ThreeTierSummer" style="font-weight: bold;">周末費用(元):</label>
            <input type="text" id="ThreeTierSummerWeekendCost" readonly value="">
        </div>
    </div>

    <div class="right-column">
        

        <span class="label-2" style="color: #0066cc; opacity: 0;">二段式</span>

        <style>
        .label-2 {
            font-weight: bold;
        }
        
        .label-2 {
            opacity: 1;
            animation: fadeInSummer 1.8s ease-in-out forwards;
        }
        
        @keyframes fadeInSummer {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        </style>
        
        <script>
        document.addEventListener("DOMContentLoaded", function() {
            const labelElementSummer = document.querySelector(".label-2");
            labelElementSummer.classList.add("animation");
        });
        </script>


        <div>
            <label for="TwoTier" style="font-weight: bold;">每日費用(元):</label>
            <input type="text" id="TwoTierDailyCost" readonly value="">
        </div>
        <div>
            <label for="TwoTier" style="font-weight: bold;">每月費用(元):</label>
            <input type="text" id="TwoTierMonthlyCost" readonly value="">
        </div>
        <div>
            <label for="TwoTier" style="font-weight: bold;">周末費用(元):</label>
            <input type="text" id="TwoTierWeekendCost" readonly value="">
        </div>

        <p></p>

        
        <span class="label-3" style="color: #0066cc; opacity: 0;">二段式夏季</span>

        <style>
        .label-3 {
            font-weight: bold;
        }
        
        .label-3 {
            opacity: 1;
            animation: fadeInSummer 1.8s ease-in-out forwards;
        }
        
        @keyframes fadeInSummer {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        </style>
        
        <script>
        document.addEventListener("DOMContentLoaded", function() {
            const labelElementSummer = document.querySelector(".label-3");
            labelElementSummer.classList.add("animation");
        });
        </script>


        <div>
            <label for="TwoTierSummer" style="font-weight: bold;">每日費用(元):</label>
            <input type="text" id="TwoTierSummerDailyCost" readonly value="">
        </div>
        <div>
            <label for="TwoTierSummer" style="font-weight: bold;">每月費用(元):</label>
            <input type="text" id="TwoTierSummerMonthlyCost" readonly value="">
        </div>
        <div>
            <label for="TwoTierSummer" style="font-weight: bold;">周末費用(元):</label>
            <input type="text" id="TwoTierSummerWeekendCost" readonly value="">
        </div>

       
    </div>
</div>


<div style="clear: both;"></div> <!-- 清除浮动 -->




{% endblock %}

{% block js_script %}

<!-- index3 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {

                // 获取新增电器按钮和电器选择框、开始时间输入框、结束时间输入框、电器列表的引用
                var addApplianceButton2 = document.getElementById("addApplianceButton2");
                var resetButton2 = document.getElementById("resetButton2");
                var packageButton2 = document.getElementById("packageButton2");
                var applianceSelect = document.getElementById("applianceSelect");
                var startTimeInput = document.getElementById("startTimeInput");
                var endTimeInput = document.getElementById("endTimeInput");
                var itemList2 = document.getElementById("itemList2");
                var outputData = []; // 存储输出数据的数组
        
                // 添加点击事件监听器到新增电器按钮
                addApplianceButton2.addEventListener("click", function() {
                    // 获取选中的电器、开始时间和结束时间
                    var selectedAppliance = applianceSelect.options[applianceSelect.selectedIndex].text;
                    var startTime = startTimeInput.value;
                    var endTime = endTimeInput.value;
        
                    // 创建新的电器项对象
                    var newApplianceItem = {
                        "device_name": selectedAppliance,
                        "start_hour": startTime,
                        "end_hour": endTime
                    };
        
                    // 将新电器项对象添加到输出数据数组
                    outputData.push(newApplianceItem);
        
                    // 创建新的电器项元素并设置其文本内容
                    var newApplianceText = selectedAppliance + ": " + startTime + " - " + endTime;
        
                    // 创建新的电器项元素并设置其文本内容
                    var newAppliance = document.createElement("div");
                    newAppliance.textContent = newApplianceText;
        
                    // 将新电器项添加到电器列表中
                    itemList2.appendChild(newAppliance);
        
                    // 清空开始时间和结束时间输入框
                    startTimeInput.value = "";
                    endTimeInput.value = "";
                });
        
                // 添加点击事件监听器到重置按钮
                resetButton2.addEventListener("click", function() {
                    // 清空电器列表和输出数据数组
                    itemList2.innerHTML = "";
                    outputData = [];
                });
        
                // 添加点击事件监听器到打包按钮
                packageButton2.addEventListener("click", function() {
                    // 生成输出数据对象
                    var outputObject = {
                        "id": "MAC address",
                        "date": "2023-09-10",
                        "usage": outputData
                    };
        
                    // 打印输出数据对象，格式为所需格式
                    // console.log(JSON.stringify(outputObject, null, 4));
                });

        // 创建并渲染长条图表
        const ctx = document.getElementById('carbonBarChart').getContext('2d');
        const data = {
            labels: ['DailyElectricity', 'MonthlyCarbonEmission', 'MonthlyElectricity'], // 电器名称将在后续添加
            datasets: [{
                label: '費用',
                data: [], // 实际数据将在后续添加
                backgroundColor: ['#FF5733', '#33FF57', '#5733FF',"#8008"], // 长条的颜色
            }],
        };

       

        const carbonBarChart = new Chart(ctx, {
            type: 'bar',
            data: data,
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    legend: {
                        display: false, // 隐藏图例
                    },
                    datalabels: {
                        display: false, // 隐藏数据标签
                    },
                }
            }
        });

        // 初始化柱状图数据
        carbonBarChart.data.datasets[0].data = [0, 0, 0];
        carbonBarChart.update();

        // 存储文本输入框的初始值
        let initialValues = {
            DailyElectricity: document.getElementById('DailyElectricity').value,
            MonthlyCarbonEmission: document.getElementById('MonthlyCarbonEmission').value,
            MonthlyElectricity: document.getElementById('MonthlyElectricity').value,
        };

        // 获取数据并更新柱状图和标签
        function updateChart(type) {
            let values = [];
            let labels = [];

            switch (type) {
                case 'show1':
                    values = [
                        $(`#DailyElectricity`).val(),
                        $(`#MonthlyCarbonEmission`).val(),
                        $(`#MonthlyElectricity`).val(),
                    ];
                    labels = ['每日電費', '每月碳排放量', '每月電費'];
                    break;
                case 'show2':
                    values = [
                        $(`#ThreeTierDailyCost`).val(),
                        $(`#ThreeTierSummerDailyCost`).val(),
                        $(`#TwoTierDailyCost`).val(),
                        $(`#TwoTierSummerDailyCost`).val(),
                    ];
                    labels = ['三段式', '三段式夏季', '二段式','二段式夏季'];
                    break;
                case 'show3':
                    values = [
                        $(`#ThreeTierMonthlyCost`).val(),
                        $(`#ThreeTierSummerMonthlyCost`).val(),
                        $(`#TwoTierMonthlyCost`).val(),
                        $(`#TwoTierSummerMonthlyCost`).val(),
                    ];
                    labels = ['三段式', '三段式夏季', '二段式','二段式夏季'];
                    break;
                case 'show4':
                    values = [
                        $(`#ThreeTierWeekendCost`).val(),
                        $(`#ThreeTierSummerWeekendCost`).val(),
                        $(`#TwoTierWeekendCost`).val(),
                        $(`#TwoTierSummerWeekendCost`).val(),
                    ];
                    labels = ['三段式', '三段式夏季', '二段式','二段式夏季'];
                    break;
                default:
                    break;
            }



            // 更新柱状图和标签
            carbonBarChart.data.datasets[0].data = values;
            carbonBarChart.data.labels = labels;
            carbonBarChart.update();

            // 恢复文本输入框的初始值

        }

        // 添加点击事件监听器，点击按钮后显示不同的数据和标签
        const showChartButton = document.getElementById('showChartButton');
        const showChartButton2 = document.getElementById('showChartButton2');
        const showChartButton3 = document.getElementById('showChartButton3');
        const showChartButton4 = document.getElementById('showChartButton4');

        showChartButton.addEventListener('click', function () {
            updateChart('show1');
        });
        showChartButton2.addEventListener('click', function () {
            updateChart('show2');
        });
        showChartButton3.addEventListener('click', function () {
            updateChart('show3');
        });
        showChartButton4.addEventListener('click', function () {
            updateChart('show4');
        });


        // 在页面加载时，首先显示默认数据
        updateChart('initial');


        $(`#packageButton2`).click(function (e){
            e.preventDefault();
            
            // 讀值
            let devicename = $('#applianceSelect').find(":selected").text();
            let starttime = $(`#startTimeInput`).val();
            let endtime = $(`#endTimeInput`).val();


            if(endtime < starttime){
                Swal.fire({
                    title: '時間設定錯誤!',
                    text: '起始時間需要小於結束時間',
                    icon: 'error',
                    confirmButtonText: '確認'
                });

                return false;
            }


            if(starttime >= 24 || endtime >= 24){
                Swal.fire({
                    title: '時間設定錯誤!',
                    text: '起始時間或結束時間不得超過 24 小時',
                    icon: 'error',
                    confirmButtonText: '確認'
                });

                return false;

            }

            // console.log("讀取:");
            // console.log(devicename,starttime, endtime);

            // 定義傳輸地址跟資料
            let url = base_url + "api/power/"; // http://127.0.0.1/api/power


            /**
            const params = new URLSearchParams();
            params.append('namedevice', devicename);
            params.append('start', starttime);
            params.append('end', endtime);

            console.log('params:', params);

            axios.post(url, params)
                .then(function(res){
                    // DOM 操作
                    //$(`#startTimeInput`).val(res.data.param2);
                    //$(`#endTimeInput`).val(res.data.param1);
                    console.log('成功');

                })
                .catch(function(e){
                    console.log(e);
                })
            */

            let data = JSON.stringify({
                id: "MAC address",
                date: "2023-09-10",
                usage: [{
                    device_name: devicename,
                    start_hour: starttime,
                    end_hour: endtime,  
                }]
            })

            axios({
                method: 'post',
                url: url,
                data: data,
                })
                .then((res)=>{
                    $(`#DailyElectricity`).val(res.data.DailyElectricity); 
                    $(`#MonthlyCarbonEmission`).val(res.data.case.Reality.MonthlyCarbonEmission); 
                    $(`#MonthlyElectricity`).val(res.data.case.Reality.MonthlyElectricity);
                    $(`#ThreeTierDailyCost`).val(res.data.case.Reality.Priciing.ThreeTier.DailyCost); 
                    $(`#ThreeTierMonthlyCost`).val(res.data.case.Reality.Priciing.ThreeTier.MonthlyCost); 
                    $(`#ThreeTierWeekendCost`).val(res.data.case.Reality.Priciing.ThreeTier.WeekendCost); 
                    $(`#ThreeTierSummerDailyCost`).val(res.data.case.Reality.Priciing.ThreeTierSummer.DailyCost); 
                    $(`#ThreeTierSummerMonthlyCost`).val(res.data.case.Reality.Priciing.ThreeTierSummer.MonthlyCost); 
                    $(`#ThreeTierSummerWeekendCost`).val(res.data.case.Reality.Priciing.ThreeTierSummer.WeekendCost); 
                    $(`#TwoTierDailyCost`).val(res.data.case.Reality.Priciing.TwoTier.DailyCost); 
                    $(`#TwoTierMonthlyCost`).val(res.data.case.Reality.Priciing.TwoTier.MonthlyCost); 
                    $(`#TwoTierWeekendCost`).val(res.data.case.Reality.Priciing.TwoTier.WeekendCost); 
                    $(`#TwoTierSummerDailyCost`).val(res.data.case.Reality.Priciing.TwoTierSummer.DailyCost); 
                    $(`#TwoTierSummerMonthlyCost`).val(res.data.case.Reality.Priciing.TwoTierSummer.MonthlyCost); 
                    $(`#TwoTierSummerWeekendCost`).val(res.data.case.Reality.Priciing.TwoTierSummer.WeekendCost);      

                })
                .catch((e)=>{
                    // console.log(e);
                });

        });
    });

</script>

{% endblock %}